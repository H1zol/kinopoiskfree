<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –≤–∏–¥–µ–æ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input[type="text"] { width: 70%; padding: 10px; margin: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f8f9fa; }
        .video-info { background: #e9ecef; padding: 10px; margin: 10px 0; border-radius: 5px; word-break: break-all; }
        .success { color: #155724; background: #d4edda; padding: 10px; border-radius: 5px; }
        .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –≤–∏–¥–µ–æ —Å—Å—ã–ª–æ–∫</h1>
        
        <input type="text" id="filmUrl" 
               value="https://ru1.hdreskaz.top/watch-film/4076646~–ù–æ–≤—ã–π+–ß–µ–ª–æ–≤–µ–∫-–ø–∞—É–∫~29-16-08"
               placeholder="–í–≤–µ–¥–∏—Ç–µ URL —Ñ–∏–ª—å–º–∞">
        <br>
        
        <button onclick="deepAnalyze()">üîç –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑</button>
        <button onclick="searchInPage()">üìÑ –ü–æ–∏—Å–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ</button>
        <button onclick="findPlayerData()">üéÆ –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –ø–ª–µ–µ—Ä–∞</button>
        <button onclick="clearResults()">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>

        <div id="result" class="result"></div>
    </div>

    <script>
        async function deepAnalyze() {
            const url = document.getElementById('filmUrl').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="video-info">üïµÔ∏è‚Äç‚ôÇÔ∏è –ù–∞—á–∏–Ω–∞–µ–º –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑...</div>';

            try {
                // –ü–æ–ª—É—á–∞–µ–º HTML —á–µ—Ä–µ–∑ AllOrigins
                const apiUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                const response = await fetch(apiUrl);
                const data = await response.json();
                const html = data.contents;

                await analyzeContent(html, url, resultDiv);
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        async function analyzeContent(html, originalUrl, resultDiv) {
            let findings = [];
            
            // 1. –ü–æ–∏—Å–∫ iframe
            const iframeRegex = /<iframe[^>]*src=["']([^"']+)["'][^>]*>/gi;
            let iframeMatch;
            while ((iframeMatch = iframeRegex.exec(html)) !== null) {
                findings.push({type: 'iframe', url: iframeMatch[1]});
            }

            // 2. –ü–æ–∏—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–º–∏
            const scriptRegex = /<script[^>]*>([\s\S]*?)<\/script>/gi;
            let scriptMatch;
            while ((scriptMatch = scriptRegex.exec(html)) !== null) {
                const scriptContent = scriptMatch[1];
                
                // –ü–æ–∏—Å–∫ m3u8 —Å—Å—ã–ª–æ–∫
                const m3u8Matches = scriptContent.match(/(https?:\/\/[^"']*\.m3u8[^"']*)/gi);
                if (m3u8Matches) {
                    m3u8Matches.forEach(url => findings.push({type: 'm3u8', url: url}));
                }

                // –ü–æ–∏—Å–∫ mp4 —Å—Å—ã–ª–æ–∫
                const mp4Matches = scriptContent.match(/(https?:\/\/[^"']*\.mp4[^"']*)/gi);
                if (mp4Matches) {
                    mp4Matches.forEach(url => findings.push({type: 'mp4', url: url}));
                }

                // –ü–æ–∏—Å–∫ JSON –¥–∞–Ω–Ω—ã—Ö —Å –≤–∏–¥–µ–æ
                const jsonMatches = scriptContent.match(/(\{[^{}]*["']file["'][^{}*\}[^{}]*\})/gi);
                if (jsonMatches) {
                    jsonMatches.forEach(jsonStr => {
                        try {
                            const data = JSON.parse(jsonStr);
                            if (data.file) {
                                findings.push({type: 'json_video', url: data.file, data: data});
                            }
                        } catch (e) {}
                    });
                }

                // –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å –≤–∏–¥–µ–æ —Å—Å—ã–ª–∫–∞–º–∏
                const varMatches = scriptContent.match(/(file|src|url)\s*[=:]\s*["']([^"']+\.(mp4|m3u8|webm))["']/gi);
                if (varMatches) {
                    varMatches.forEach(match => {
                        const urlMatch = match.match(/["']([^"']+)["']/);
                        if (urlMatch) {
                            findings.push({type: 'js_variable', url: urlMatch[1], context: match});
                        }
                    });
                }
            }

            // 3. –ü–æ–∏—Å–∫ –≤ data-–∞—Ç—Ä–∏–±—É—Ç–∞—Ö
            const dataAttrRegex = /data-(file|src|url)=["']([^"']+)["']/gi;
            let dataMatch;
            while ((dataMatch = dataAttrRegex.exec(html)) !== null) {
                findings.push({type: 'data_attribute', url: dataMatch[2], attr: dataMatch[1]});
            }

            // 4. –ü–æ–∏—Å–∫ API endpoints
            const apiRegex = /(https?:\/\/[^"']*\/api\/[^"']*|https?:\/\/[^"']*\/player\/[^"']*|https?:\/\/[^"']*\/video\/[^"']*)/gi;
            const apiMatches = html.match(apiRegex);
            if (apiMatches) {
                apiMatches.forEach(url => findings.push({type: 'api_endpoint', url: url}));
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            displayFindings(findings, resultDiv, originalUrl);
        }

        function displayFindings(findings, resultDiv, originalUrl) {
            if (findings.length === 0) {
                resultDiv.innerHTML = '<div class="error">‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö</div>';
                return;
            }

            let html = `<div class="success">‚úÖ –ù–∞–π–¥–µ–Ω–æ ${findings.length} –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤–∏–¥–µ–æ</div>`;
            
            findings.forEach((finding, index) => {
                const fullUrl = finding.url.startsWith('http') ? finding.url : new URL(finding.url, originalUrl).href;
                
                html += `
                    <div class="video-info">
                        <strong>üîç –ù–∞—Ö–æ–¥–∫–∞ ${index + 1} (${finding.type}):</strong><br>
                        <strong>URL:</strong> ${fullUrl}<br>
                        ${finding.context ? `<strong>–ö–æ–Ω—Ç–µ–∫—Å—Ç:</strong> ${finding.context}<br>` : ''}
                        ${finding.attr ? `<strong>–ê—Ç—Ä–∏–±—É—Ç:</strong> ${finding.attr}<br>` : ''}
                        
                        <button onclick="testVideoUrl('${fullUrl}')">üé¨ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å URL</button>
                        <button onclick="copyToClipboard('${fullUrl}')">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        
                        ${finding.type === 'm3u8' || finding.type === 'mp4' ? `
                            <div style="margin-top: 10px;">
                                <video controls width="300" height="200">
                                    <source src="${fullUrl}" type="${finding.type === 'm3u8' ? 'application/x-mpegURL' : 'video/mp4'}">
                                </video>
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
        }

        async function searchInPage() {
            const url = document.getElementById('filmUrl').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="video-info">üîç –ò—â–µ–º –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ...</div>';

            try {
                const apiUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                const response = await fetch(apiUrl);
                const data = await response.json();
                const html = data.contents;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
                resultDiv.innerHTML = `
                    <div class="success">üìÑ –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:</div>
                    <div class="video-info">
                        <textarea style="width:100%; height:400px; font-family: monospace; font-size: 12px;" 
                                  onclick="this.select()">${html}</textarea>
                    </div>
                    <div class="video-info">
                        <strong>üîé –†—É—á–Ω–æ–π –ø–æ–∏—Å–∫:</strong><br>
                        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Ctrl+F –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º:<br>
                        - file:<br>
                        - src:<br> 
                        - m3u8<br>
                        - mp4<br>
                        - video<br>
                        - player<br>
                        - iframe<br>
                        - embed<br>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        async function findPlayerData() {
            const url = document.getElementById('filmUrl').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="video-info">üéÆ –ò—â–µ–º –¥–∞–Ω–Ω—ã–µ –ø–ª–µ–µ—Ä–∞...</div>';

            try {
                const apiUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                const response = await fetch(apiUrl);
                const data = await response.json();
                const html = data.contents;

                // –ò—â–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è HDRezka
                const patterns = {
                    'video_data': /video\s*:\s*({[^}]+})/g,
                    'file_data': /file\s*:\s*["']([^"']+)["']/g,
                    'player_config': /player\.setup\s*\(([^)]+)\)/g,
                    'stream_data': /stream\s*:\s*["']([^"']+)["']/g,
                    'hls_url': /(https?:\/\/[^"']*\.m3u8[^"']*)/g,
                    'mp4_url': /(https?:\/\/[^"']*\.mp4[^"']*)/g
                };

                let results = [];
                for (const [patternName, pattern] of Object.entries(patterns)) {
                    const matches = html.match(pattern);
                    if (matches) {
                        matches.forEach(match => {
                            results.push({type: patternName, data: match});
                        });
                    }
                }

                if (results.length > 0) {
                    let htmlOutput = '<div class="success">‚úÖ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–ª–µ–µ—Ä–∞:</div>';
                    results.forEach((result, index) => {
                        htmlOutput += `
                            <div class="video-info">
                                <strong>${index + 1}. ${result.type}:</strong><br>
                                <code>${result.data}</code>
                            </div>
                        `;
                    });
                    resultDiv.innerHTML = htmlOutput;
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå –î–∞–Ω–Ω—ã–µ –ø–ª–µ–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                }

            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        async function testVideoUrl(videoUrl) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML += `<div class="video-info">üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º URL: ${videoUrl}</div>`;

            try {
                const testResponse = await fetch(videoUrl, {method: 'HEAD'});
                if (testResponse.ok) {
                    resultDiv.innerHTML += `<div class="success">‚úÖ URL –¥–æ—Å—Ç—É–ø–µ–Ω! –°—Ç–∞—Ç—É—Å: ${testResponse.status}</div>`;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ –ø–ª–µ–µ—Ä
                    resultDiv.innerHTML += `
                        <div class="video-info">
                            <strong>üé¨ –í–∏–¥–µ–æ –ø–ª–µ–µ—Ä:</strong><br>
                            <video controls width="100%" style="max-width: 600px;">
                                <source src="${videoUrl}" type="video/mp4">
                                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ —Ç–µ–≥.
                            </video>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML += `<div class="error">‚ùå URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω! –°—Ç–∞—Ç—É—Å: ${testResponse.status}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML += `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}</div>`;
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            });
        }

        function clearResults() {
            document.getElementById('result').innerHTML = '';
        }
    </script>
</body>
</html>